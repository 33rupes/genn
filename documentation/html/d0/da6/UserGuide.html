<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>GeNN: Suggestions for users</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<!--This is Google Analytics Tracking Code-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-57354659-1', 'auto');
  ga('send', 'pageview');
</script>
<!--End of Google Analytics Tracking Code-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em; padding-bottom: 0.5em;" id="projectlogo"><img alt="Logo" src="../../GeNN-logo-55px.gif"/></td>
  <td style="padding-left: 3.5em; padding-bottom: 0.5em;">
   <div id="projectname">GeNN
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">GPU enhanced Neuronal Networks (GeNN)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d0/da6/UserGuide.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Suggestions for users </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>GeNN generates code according to the network model defined by the user, but lets users use generated code the way they want. Here we explain how to setup GeNN and how to use generated functions. We recommend users to take a look at the <a class="el" href="../../d9/d61/Examples.html">Examples</a>, and to follow the tutorials <a class="el" href="../../d5/dbb/Tutorial1.html">Tutorial 1</a> and <a class="el" href="../../dc/d7e/Tutorial2.html">Tutorial 2</a>.</p>
<h1><a class="anchor" id="CreateAndSimulate"></a>
Creating and simulating a network model</h1>
<p>The user is first expected to create an object of class <a class="el" href="../../dc/de5/classNNmodel.html" title="Structure to hold the information that defines synapse dynamics (a model of how synapse variables cha...">NNmodel</a> by creating the function <a class="el" href="../../d9/dba/HHVClamp_8cc.html#a9aeaa0a22980484b2c472564fc9f686e" title="This function defines the HH model with variable parameters. ">modelDefinition()</a> which includes calls to following methods in correct order:</p>
<ul>
<li><a class="el" href="../../d7/dfd/modelSpec_8cc.html#a62ce532f6f7e535adfb9fe151a1c0c6b" title="Method for GeNN initialisation (by preparing standard models) ">initGeNN()</a>;</li>
<li><a class="el" href="../../dc/de5/classNNmodel.html#a757eff2a5877688e6e5492726df035ee" title="Method to set the neuronal network model name. ">NNmodel::setName()</a>;</li>
</ul>
<p>Then add neuron populations by:</p>
<ul>
<li><a class="el" href="../../dc/de5/classNNmodel.html#a32c254358da2f8c43c91291d24cfd295" title="Method for adding a neuron population to a neuronal network model, using C style character array for ...">NNmodel::addNeuronPopulation()</a>;</li>
</ul>
<p>for each neuron population. Add synapse populations by:</p>
<ul>
<li><a class="el" href="../../dc/de5/classNNmodel.html#ae252945f336a330ec1c69f24cb1d4203" title="Overload of method for backwards compatibility. ">NNmodel::addSynapsePopulation()</a>;</li>
</ul>
<p>for each synapse population.</p>
<p>Other optional functions are explained in <a class="el" href="../../dc/de5/classNNmodel.html" title="Structure to hold the information that defines synapse dynamics (a model of how synapse variables cha...">NNmodel</a> class reference. At the end the function should look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="../../d9/dba/HHVClamp_8cc.html#a9aeaa0a22980484b2c472564fc9f686e">modelDefinition</a>(NNModel &amp;model) {</div>
<div class="line">  <a class="code" href="../../d7/dfd/modelSpec_8cc.html#a62ce532f6f7e535adfb9fe151a1c0c6b">initGeNN</a>();</div>
<div class="line">  model.setName(<span class="stringliteral">&quot;YourModelName&quot;</span>);</div>
<div class="line">  model.addNeuronPopulation(...);</div>
<div class="line">  ...</div>
<div class="line">  model.addSynapsePopulation(...);</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="el" href="../../dc/de1/modelSpec_8h.html" title="Header file that contains the class (struct) definition of neuronModel for defining a neuron model an...">modelSpec.h</a> and <a class="el" href="../../d7/dfd/modelSpec_8cc.html">modelSpec.cc</a> should be included in the file where this function is defined.</p>
<p>This function will be called by <a class="el" href="../../df/d10/generateALL_8cc.html" title="Main file combining the code for code generation. Part of the code generation section. ">generateALL.cc</a> to create corresponding CPU and GPU simulation codes under the &lt;YourModelName&gt;_CODE directory.</p>
<p>These functions can then be used in a .cu file which runs the simulation. This file should include &lt;YourModelName&gt;_CODE/runner.cc. Generated code differ from one model to the other, but core functions are the same and they should be called in correct order. First, following variables should be defined and initialized:</p>
<ul>
<li><a class="el" href="../../dc/de5/classNNmodel.html" title="Structure to hold the information that defines synapse dynamics (a model of how synapse variables cha...">NNmodel</a> model // initialized by calling modelDefinition(model)</li>
<li>Array containing current input (if any)</li>
</ul>
<p>Following are declared by GeNN but should be initialized by the user:</p><ul>
<li>Poisson neuron offset and rates (if any)</li>
<li>Connectivity matrices (if sparse)</li>
<li>Neuron and synapse variables (if not initialising to same value)</li>
</ul>
<p>Core functions generated by GeNN to be included in the user code include:</p>
<ul>
<li>allocateMem()</li>
<li>deviceMemAllocate()</li>
<li>allocate&lt;synapse name&gt;(unsigned int SparseProjection.connN) //for sparse connectivity only</li>
<li>initialize()</li>
<li>initializeAllSparseArrays()</li>
<li>convertProbabilityToRandomNumberThreshold()</li>
<li>copyStateToDevice()</li>
<li>push&lt;neuron or synapse name&gt;toDevice()</li>
<li>pull&lt;neuron or synapse name&gt;fromDevice()</li>
<li>copyStateFromDevice()</li>
<li>copySpikeNFromDevice()</li>
<li>copySpikesFromDevice()</li>
<li>stepTimeCPU() //arguments depend on model</li>
<li>stepTimeGPU() //arguments depend on model</li>
<li>freeMem()</li>
<li>freeDeviceMem()</li>
</ul>
<p>Copying elements from GPU to host memory is very costly in terms of performance and should only be done when needed.</p>
<h1><a class="anchor" id="floatPrecision"></a>
Floating point precision</h1>
<p>Double precision floating point numbers are supported by devices with compute capability 1.3 or higher. If you have an older GPU, you need to use single precision floating point in your models and simulation.</p>
<p>GPUs are designed to work better with single precision while double precision is the standard for CPUs. This difference should be kept in mind while compaing performance.</p>
<p>While setting up the network for GeNN, double precision floating point numbers are used as this part is done on the CPU. For the simulation, GeNN lets users choose between single or double precision. Overall, new variables in the generated code are defined with the precision specified by <a class="el" href="../../dc/de5/classNNmodel.html#a44fb38b93216c56254fbbee6175cffd1" title="Set numerical precision for floating point. ">NNmodel::setPrecision(unsigned int)</a>, providing FLOAT or DOUBLE as argument. FLOAT is the default value. Keyword <code>scalar</code> can be used in the user-defined model codes for an interchangeable precision. This keyword is detected at code generation and substituted with "float" or "double" according to the precision set by <a class="el" href="../../dc/de5/classNNmodel.html#a44fb38b93216c56254fbbee6175cffd1" title="Set numerical precision for floating point. ">NNmodel::setPrecision(unsigned int)</a>.</p>
<p>There may be ambiguities in arithmetic operations using explicit numbers. Standard C compilers presume that any number defined as "X" is an integer and any number defined as "X.Y" is a double. Make sure to use same precision in your operations in order to avoid performance loss.</p>
<h1><a class="anchor" id="ListOfVariables"></a>
Working with variables in GeNN</h1>
<h2><a class="anchor" id="modelVars"></a>
Model variables</h2>
<p>User-defined model variables originate from core units such as <a class="el" href="../../d3/d64/structneuronModel.html" title="class (struct) for specifying a neuron model. ">neuronModel</a>, <a class="el" href="../../dd/db7/classweightUpdateModel.html" title="Structure to hold the information that defines a weightupdate model (a model of how spikes affect syn...">weightUpdateModel</a> or <a class="el" href="../../d8/dbb/structpostSynModel.html" title="Structure to hold the information that defines a post-synaptic model (a model of how synapses affect ...">postSynModel</a> object. The name of the variable is defined when the model type is introduced, i.e. with a statement such as </p><div class="fragment"><div class="line"><a class="code" href="../../d3/d64/structneuronModel.html">neuronModel</a> model;</div>
<div class="line">model.<a class="code" href="../../d3/d64/structneuronModel.html#a9a9156ffb643572fd67f6e585ef79ad0">varNames</a>.push_back(String<span class="stringliteral">&quot;x&quot;</span>));</div>
<div class="line">model.<a class="code" href="../../d3/d64/structneuronModel.html#a86788cb29131da0a26ce79693a076352">varTypes</a>.push_back(String(<span class="stringliteral">&quot;double&quot;</span>));</div>
<div class="line">...</div>
<div class="line">int myModel= <a class="code" href="../../d5/d60/utils_8h.html#a2bd39d11c2cd6cec9bf9b81c183b6cd4">nModels</a>.size();</div>
<div class="line"><a class="code" href="../../d5/d60/utils_8h.html#a2bd39d11c2cd6cec9bf9b81c183b6cd4">nModels</a>.push_back(model);</div>
</div><!-- fragment --><p> This declares that whenever the defined model type of cardinal number <code>myModel</code> is used, there will be a variable of core name <code>x</code>. varType can be of <code>scalar</code> type (see <a class="el" href="../../d0/da6/UserGuide.html#floatPrecision">Floating point precision</a>). The full GeNN name of this variable is obtained by directly concatenating the core name with the name of the neuron population in which the model type has been used, i.e. after a definition </p><div class="fragment"><div class="line">networkModel.addNeuronPopulation(<span class="stringliteral">&quot;EN&quot;</span>, n, myModel, ...);</div>
</div><!-- fragment --><p> there will be a variable <code>xEN</code> of type <code>double*</code> available in the global namespace of the simulation program. GeNN will pre-allocated this C array to the correct size of elements corresponding to the size of the neuron population, <code>n</code> in the example above. GeNN will also free these variables when the provided function <code>freeMem()</code> is called. Users can otherwise manipulate these variable arrays as they wish. For convenience, GeNN provides functions <code>pullXXfromDevice()</code> and <code>pushXXtoDevice()</code> to copy the variables associated to a neuron population <code>XX</code> from the device into host memory and vice versa. E.g. </p><div class="fragment"><div class="line">pullENfromDevice();</div>
</div><!-- fragment --><p> would copy the C array xEN from device memory into host memory (and any other variables that the neuron type of the population EN may have).</p>
<p>The user can also directly use CUDA memory copy commands independent of the provided convenience function. The relevant device pointers for all variables that exist in host memory have the same name prefixed with <code>d_</code>. For example, the copy command that would be contained in <code>pullENfromDevice()</code> might look like </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size;      </div>
<div class="line">size = <span class="keyword">sizeof</span>(double) * nEN;</div>
<div class="line">cudaMemcpy(xEN, d_xEN, size, cudaMemcpyDeviceToHost);</div>
</div><!-- fragment --><p> where <code>n</code> is an integer containing the population size of the EN neuron population.</p>
<p>The same convention as for neuron variables applies for the variables of synapse groups, both for those originating from weightupdate models and from post-synaptic models, e.g. the variables in type <code>NSYNAPSE</code> contain the variable <code>g</code> of type float. Then, after </p><div class="fragment"><div class="line">networkModel.addSynapsePopulation(<span class="stringliteral">&quot;ENIN&quot;</span>, <a class="code" href="../../dc/de1/modelSpec_8h.html#a1110b98e1962bdb6bcc86b647b1431d4">NSYNAPSE</a>, ...);</div>
</div><!-- fragment --><p> there will be a global variable of type <code>float*</code> with the name <code>gENIN</code> that is pre-allocated to the right size. There will also be a matching device pointer with the name <code>d_gENIN</code>. </p><dl class="section note"><dt>Note</dt><dd>The content of <code>gENIN</code> needs to be interpreted differently for DENSE connectivity and sparse matrix based SPARSE connectivity representations. For DENSE connectivity <code>gENIN</code> would contain "n_pre" times "n_post" elements, ordered along the pre-synaptic neuronsas the major dimension, i.e. the value of <code>gENIN</code> for the ith pre-synaptic neuron and the jth post-synaptic neuron would be <code>gENIN[i*n_post+j]</code>. The arrangement of values in the SPARSE representation is explained in section <a class="el" href="../../d5/d24/sectSynapseModels.html#subsect32">Connectivity types</a></dd></dl>
<h2><a class="anchor" id="predefinedVars"></a>
Built-in Variables in GeNN</h2>
<p>With GeNN 2.0, there are no more explicitly hard-coded variables. Users are free to call the variable of their models as they want. However, there are some reserved variables that are used for intermediary calculations and communication between different parts of the generated code. They can be used in the user defined code but no other variables should be defined with these names.</p>
<ul>
<li><code>addtoinSyn</code> : This variable is used by <a class="el" href="../../dd/db7/classweightUpdateModel.html" title="Structure to hold the information that defines a weightupdate model (a model of how spikes affect syn...">weightUpdateModel</a> for updating synaptic input. The way it is modified is defined in <a class="el" href="../../dd/db7/classweightUpdateModel.html#a6f665453175451356bbf14b9f60baed3" title="Simulation code that is used for true spikes (only one time step after spike detection) ...">weightUpdateModel.simCode</a> or <a class="el" href="../../dd/db7/classweightUpdateModel.html#a758cc3211ae12407583f625418dd5a89" title="Simulation code that is used for spike events (all the instances where event threshold condition is m...">weightUpdateModel.simCodeEvnt</a>, therefore if a user defines her own model she should update this variable to contain the input to the post-synaptic model.</li>
<li><code>updatelinsyn</code> : At the end of the synaptic update by <code>addtoinSyn</code>, final values are copied back to the d_inSyn&lt;synapsePopulation&gt; variables which will be used in the next step of the neuron update to provide the input to the postsynaptic neurons.</li>
<li><code>inSyn</code> : This is an intermediary synapse variable which contains everything is transferred from a presynaptic neuron (by using <code>addtoinSyn</code> variable) to a postsynaptic neuron.</li>
<li><code>Isyn</code> : This is a local variable which defines the (summed) input current to a neuron. It is typically the sum of any explicit current input and all synaptic inputs. The way its value is calculated during the update of the postsynaptic neuron is defined by the code provided in the <a class="el" href="../../d8/dbb/structpostSynModel.html" title="Structure to hold the information that defines a post-synaptic model (a model of how synapses affect ...">postSynModel</a>. For example, the standard <code>EXPDECAY</code> postsynaptic model defines ps.postSyntoCurrent= String("$(inSyn)*($(E)-$(V))");  which implements a conductance based synapse in which the postsynaptic current is given by <img class="formulaInl" alt="$I_{\rm syn}= g*s*(V_{\rm rev}-V_{\rm post})$" src="../../form_20.png"/>. <dl class="section note"><dt>Note</dt><dd>The <code>addtoinSyn</code> variables from all incoming synapses are automatically summed and added to the current value of <code>inSyn</code>.</dd></dl>
The value resulting from the <code>postSyntoCurrent</code> code is assigned to <code>Isyn</code> and can then be used in neuron simCode like so: <div class="fragment"><div class="line">$(V)+= (-$(V)+$(Isyn))*<a class="code" href="../../d9/dba/HHVClamp_8cc.html#a943f07034774ef1261d62cd0d3d1fec9">DT</a> </div>
</div><!-- fragment --></li>
<li><code>sT</code> : As a neuron variable, this is the last spike time in a neuron and is automatically generated for pre and postsynaptic neuron groups of a synapse group i that follows a spike based learning rule (indicated by usesPostLearning[i]= TRUE for the ith synapse population).</li>
<li><code>sT_pre</code> : Spike time of the presynaptic neuron population.</li>
<li><code>sT_post</code> : Spike time of the postsynaptic neuron population.</li>
</ul>
<h1><a class="anchor" id="Debugging"></a>
Debugging suggestions</h1>
<p>In Linux, users can use cuda-gdb to debug GPU. Example projects in userproject and lib/bin/buildmodel.sh come with a flag to enable debugging. If you are using a project with debugging, the code will be compiled with -g -G flags. In CPU mode the executable will be run in gdb, and in GPU mode it will be run in cuda-gdb in tui mode. <br />
 </p><hr/>
<p> <a class="el" href="../../">Previous</a> | <a class="el" href="../../d0/da6/UserGuide.html#ListOfVariables">Top</a> | <a class="el" href="../../dd/d51/Credits.html">Next</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 22 2014 23:15:37 for GeNN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
