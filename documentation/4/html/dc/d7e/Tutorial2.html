<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>GeNN: Tutorial 2</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<!--This is Google Analytics Tracking Code-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-57354659-1', 'auto');
  ga('send', 'pageview');
</script>
<!--End of Google Analytics Tracking Code-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="../../html_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em; padding-bottom: 0.5em;" id="projectlogo"><img alt="Logo" src="../../GeNN-logo-55px.gif"/></td>
  <td style="padding-left: 3.5em; padding-bottom: 0.5em;">
   <div id="projectname">GeNN
   &#160;<span id="projectnumber">4.3.2</span>
   </div>
   <div id="projectbrief">GPU enhanced Neuronal Networks (GeNN)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dc/d7e/Tutorial2.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial we will learn to add synapsePopulations to connect neurons in neuron groups to each other with synaptic models. As an example we will connect the ten Hodgkin-Huxley neurons from tutorial 1 in a ring of excitatory synapses.</p>
<p>First, copy the files from Tutorial 1 into a new directory and rename the <code>tenHHModel.cc</code> to <code>tenHHRingModel.cc</code> and <code>tenHHSimulation.cc</code> to <code>tenHHRingSimulation.cc</code>, e.g. on Linux or Mac: </p><div class="fragment"><div class="line">&gt;&gt; cp -r tenHH_project tenHHRing_project</div><div class="line">&gt;&gt; cd tenHHRing_project</div><div class="line">&gt;&gt; mv tenHHModel.cc tenHHRingModel.cc</div><div class="line">&gt;&gt; mv tenHHSimulation.cc tenHHRingSimulation.cc</div></div><!-- fragment --><p> Finally, to reduce confusion we should rename the model itself. Open <code>tenHHRingModel.cc</code>, change the model name inside, </p><div class="fragment"><div class="line">model.<a class="code" href="../../da/dfd/classModelSpec.html#ada1aff7a94eeb36dff721f09d5cf94b4">setName</a>(<span class="stringliteral">&quot;tenHHRing&quot;</span>);</div></div><!-- fragment --><h1><a class="anchor" id="SynapseMatrix"></a>
Defining the Detailed Synaptic Connections</h1>
<p>We want to connect our ten neurons into a ring where each neuron connects to its neighbours. In order to initialise this connectivity we need to add a sparse connectivity initialisation snippet at the top of <code>tenHHRingModel.cc</code>: </p><div class="fragment"><div class="line"><span class="keyword">class </span>Ring : <span class="keyword">public</span> <a class="code" href="../../d5/d9f/classInitSparseConnectivitySnippet_1_1Base.html">InitSparseConnectivitySnippet::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../de/d6c/snippet_8h.html#ac5727a6720d28f034afadde948ed6e9a">DECLARE_SNIPPET</a>(Ring, 0);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a3758f6bc5bc997383426d5f277b8acc9">SET_ROW_BUILD_CODE</a>(</div><div class="line">        <span class="stringliteral">&quot;$(addSynapse, ($(id_pre) + 1) % $(num_post));\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;$(endRow);\n&quot;</span>);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a338915170111c85ba647e848d28ee2a9">SET_MAX_ROW_LENGTH</a>(1);</div><div class="line">};</div><div class="line"><a class="code" href="../../de/d6c/snippet_8h.html#af3c47debe5fc34060e716d7db25462ab">IMPLEMENT_SNIPPET</a>(Ring);</div></div><!-- fragment --><p> The <code>SET_ROW_BUILD_CODE</code> code string will be called to generate each row of the synaptic matrix (connections coming from a single presynaptic neuron) and, in this case, each row consists of a single synapses from the presynaptic neuron $(id_pre) to $(id_pre) + 1 (the modulus operator is used to ensure that the final connection between neuron <code>9</code> and <code>0</code> is made correctly). In order to allow GeNN to better optimise the generated code we also provide a maximum row length. In this case each row always contains only one synapse but, when more complex connectivity is used, the number of neurons in the pre and postsynaptic population as well as any parameters used to configure the snippet can be accessed from this function. </p><dl class="section note"><dt>Note</dt><dd>When defining GeNN code strings, the $(VariableName) syntax is used to refer to variables provided by GeNN and the $(FunctionName, Parameter1,...) syntax is used to call functions provided by GeNN.</dd></dl>
<h1><a class="anchor" id="addSynapse"></a>
Adding Synaptic connections</h1>
<p>Now we need additional initial values and parameters for the synapse and post-synaptic models. We will use the standard <a class="el" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html" title="Pulse-coupled, static synapse. ">WeightUpdateModels::StaticPulse</a> weight update model and <a class="el" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html" title="Exponential decay with synaptic input treated as a conductance value. ">PostsynapticModels::ExpCond</a> post-synaptic model. They need the following initial variables and parameters: </p><div class="fragment"><div class="line">WeightUpdateModels::StaticPulse::VarValues s_ini(</div><div class="line">    -0.2); <span class="comment">// 0 - g: the synaptic conductance value</span></div><div class="line"></div><div class="line"><a class="code" href="../../da/d76/classSnippet_1_1ValueBase.html">PostsynapticModels::ExpCond::ParamValues</a> ps_p(</div><div class="line">    1.0,    <span class="comment">// 0 - tau_S: decay time constant for S [ms]</span></div><div class="line">    -80.0); <span class="comment">// 1 - Erev: Reversal potential</span></div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>the <a class="el" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html" title="Pulse-coupled, static synapse. ">WeightUpdateModels::StaticPulse</a> weight update model has no parameters and the <a class="el" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html" title="Exponential decay with synaptic input treated as a conductance value. ">PostsynapticModels::ExpCond</a> post-synaptic model has no state variables.</dd></dl>
<p>We can then add a synapse population at the end of the <code>modelDefinition(...)</code> function, </p><div class="fragment"><div class="line">model.<a class="code" href="../../da/dfd/classModelSpec.html#abd4e9128a5d4f5f993907134218af0c2">addSynapsePopulation</a>&lt;<a class="code" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html">WeightUpdateModels::StaticPulse</a>, <a class="code" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html">PostsynapticModels::ExpCond</a>&gt;(</div><div class="line">    <span class="stringliteral">&quot;Pop1self&quot;</span>, <a class="code" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9ca14329718a99dc337fa3bd33b9104d75d">SynapseMatrixType::SPARSE_GLOBALG</a>, 10,</div><div class="line">    <span class="stringliteral">&quot;Pop1&quot;</span>, <span class="stringliteral">&quot;Pop1&quot;</span>,</div><div class="line">    {}, s_ini,</div><div class="line">    ps_p, {},</div><div class="line">    initConnectivity&lt;Ring&gt;());</div></div><!-- fragment --><p> The addSynapsePopulation parameters are </p><ul>
<li>WeightUpdateModel: template parameter specifying the type of weight update model (derived from <a class="el" href="../../d2/d05/classWeightUpdateModels_1_1Base.html" title="Base class for all weight update models. ">WeightUpdateModels::Base</a>). </li>
<li>PostsynapticModel: template parameter specifying the type of postsynaptic model (derived from <a class="el" href="../../d1/d3a/classPostsynapticModels_1_1Base.html" title="Base class for all postsynaptic models. ">PostsynapticModels::Base</a>). </li>
<li>name string containing unique name of synapse population. </li>
<li>mtype how the synaptic matrix associated with this synapse population should be represented. Here <a class="el" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9ca14329718a99dc337fa3bd33b9104d75d">SynapseMatrixType::SPARSE_GLOBALG</a> means that there will be sparse connectivity and each connection will have the same weight (-0.2 as specified previously). </li>
<li>delayStep integer specifying number of timesteps of propagation delay that spikes travelling through this synapses population should incur (or NO_DELAY for none) </li>
<li>src string specifying name of presynaptic (source) population </li>
<li>trg string specifying name of postsynaptic (target) population </li>
<li>weightParamValues parameters for weight update model wrapped in WeightUpdateModel::ParamValues object. </li>
<li>weightVarInitialisers initial values or initialisation snippets for the weight update model's state variables wrapped in a WeightUpdateModel::VarValues object. </li>
<li>postsynapticParamValues parameters for postsynaptic model wrapped in PostsynapticModel::ParamValues object. </li>
<li>postsynapticVarInitialisers initial values or initialisation snippets for the postsynaptic model wrapped in PostsynapticModel::VarValues object. </li>
<li>connectivityInitialiser snippet and any paramaters (in this case there are none) used to initialise the synapse population's sparse connectivity.</li>
</ul>
<p>Adding the addSynapsePopulation command to the model definition informs GeNN that there will be synapses between the named neuron populations, here between population <code>Pop1</code> and itself. At this point our model definition file <code>tenHHRingModel.cc</code> should look like this </p><div class="fragment"><div class="line"><span class="comment">// Model definition file tenHHRing.cc</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dc/de1/modelSpec_8h.html">modelSpec.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>Ring : <span class="keyword">public</span> <a class="code" href="../../d5/d9f/classInitSparseConnectivitySnippet_1_1Base.html">InitSparseConnectivitySnippet::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../de/d6c/snippet_8h.html#ac5727a6720d28f034afadde948ed6e9a">DECLARE_SNIPPET</a>(Ring, 0);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a3758f6bc5bc997383426d5f277b8acc9">SET_ROW_BUILD_CODE</a>(</div><div class="line">        <span class="stringliteral">&quot;$(addSynapse, ($(id_pre) + 1) % $(num_post));\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;$(endRow);\n&quot;</span>);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a338915170111c85ba647e848d28ee2a9">SET_MAX_ROW_LENGTH</a>(1);</div><div class="line">};</div><div class="line"><a class="code" href="../../de/d6c/snippet_8h.html#af3c47debe5fc34060e716d7db25462ab">IMPLEMENT_SNIPPET</a>(Ring);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> modelDefinition(<a class="code" href="../../da/dfd/classModelSpec.html">ModelSpec</a> &amp;model)</div><div class="line">{</div><div class="line">    <span class="comment">// definition of tenHHRing</span></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#a329236a3b07044b82bfda5b4f741d8e1">setDT</a>(0.1);</div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#ada1aff7a94eeb36dff721f09d5cf94b4">setName</a>(<span class="stringliteral">&quot;tenHHRing&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="../../da/d76/classSnippet_1_1ValueBase.html">NeuronModels::TraubMiles::ParamValues</a> p(</div><div class="line">        7.15,       <span class="comment">// 0 - gNa: Na conductance in muS</span></div><div class="line">        50.0,       <span class="comment">// 1 - ENa: Na equi potential in mV</span></div><div class="line">        1.43,       <span class="comment">// 2 - gK: K conductance in muS</span></div><div class="line">        -95.0,      <span class="comment">// 3 - EK: K equi potential in mV</span></div><div class="line">        0.02672,    <span class="comment">// 4 - gl: leak conductance in muS</span></div><div class="line">        -63.563,    <span class="comment">// 5 - El: leak equi potential in mV</span></div><div class="line">        0.143);     <span class="comment">// 6 - Cmem: membr. capacity density in nF</span></div><div class="line"></div><div class="line">    <a class="code" href="../../d6/d24/classModels_1_1VarInitContainerBase.html">NeuronModels::TraubMiles::VarValues</a> ini(</div><div class="line">        -60.0,         <span class="comment">// 0 - membrane potential V</span></div><div class="line">        0.0529324,     <span class="comment">// 1 - prob. for Na channel activation m</span></div><div class="line">        0.3176767,     <span class="comment">// 2 - prob. for not Na channel blocking h</span></div><div class="line">        0.5961207);    <span class="comment">// 3 - prob. for K channel activation n</span></div><div class="line"></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#ad990a7f4af4616daf1ba633133616269">addNeuronPopulation</a>&lt;<a class="code" href="../../d2/dc3/classNeuronModels_1_1TraubMiles.html">NeuronModels::TraubMiles</a>&gt;(<span class="stringliteral">&quot;Pop1&quot;</span>, 10, p, ini);</div><div class="line"></div><div class="line">    WeightUpdateModels::StaticPulse::VarValues s_ini(</div><div class="line">         -0.2); <span class="comment">// 0 - g: the synaptic conductance value</span></div><div class="line"></div><div class="line">    <a class="code" href="../../da/d76/classSnippet_1_1ValueBase.html">PostsynapticModels::ExpCond::ParamValues</a> ps_p(</div><div class="line">        1.0,    <span class="comment">// 0 - tau_S: decay time constant for S [ms]</span></div><div class="line">        -80.0); <span class="comment">// 1 - Erev: Reversal potential</span></div><div class="line"></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#abd4e9128a5d4f5f993907134218af0c2">addSynapsePopulation</a>&lt;<a class="code" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html">WeightUpdateModels::StaticPulse</a>, <a class="code" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html">PostsynapticModels::ExpCond</a>&gt;(</div><div class="line">        <span class="stringliteral">&quot;Pop1self&quot;</span>, <a class="code" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9ca14329718a99dc337fa3bd33b9104d75d">SynapseMatrixType::SPARSE_GLOBALG</a>, 100,</div><div class="line">        <span class="stringliteral">&quot;Pop1&quot;</span>, <span class="stringliteral">&quot;Pop1&quot;</span>,</div><div class="line">        {}, s_ini,</div><div class="line">        ps_p, {},</div><div class="line">        initConnectivity&lt;Ring&gt;());</div><div class="line">}</div></div><!-- fragment --><p>We can now build our new model: </p><div class="fragment"><div class="line">&gt;&gt; genn-buildmodel.sh tenHHRingModel.cc</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Again, if you don't have an NVIDIA GPU and are running GeNN in CPU_ONLY mode, you can instead build with the <code>-c</code> option as described in <a class="el" href="../../d5/dbb/Tutorial1.html">Tutorial 1</a>.</dd></dl>
<p>Now we can open the <code>tenHHRingSimulation.cc</code> file and update the file name of the model includes to match the name we set previously: </p><div class="fragment"><div class="line"><span class="comment">// tenHHRingModel simulation code</span></div><div class="line"><span class="preprocessor">#include &quot;tenHHRing_CODE/definitions.h&quot;</span></div></div><!-- fragment --><p>Additionally, we need to add a call to a second initialisation function to <code>main()</code> after we call <code>initialize()</code>: </p><div class="fragment"><div class="line">initializeSparse();</div></div><!-- fragment --><p> This initializes any variables associated with the sparse connectivity we have added (and will also copy any manually initialised variables to the GPU). Then, after using the <code>genn-create-user-project</code> tool to create a new project with a model name of <code>tenHHRing</code> and using <code>tenHHRingSimulation.cc</code> rather than <code>tenHHSimulation.cc</code>, we can build and run our new simulator in the same way we did in <a class="el" href="../../d5/dbb/Tutorial1.html">Tutorial 1</a>. However, even after all our hard work, if we plot the content of the first column against the subsequent 10 columns of <code>tenHHexample.V.dat</code> it looks very similar to the plot we obtained at the end of <a class="el" href="../../d5/dbb/Tutorial1.html">Tutorial 1</a>. </p><div class="image">
<img src="../../tenHHRingexample1.png" alt="tenHHRingexample1.png"/>
</div>
 <p>This is because none of the neurons are spiking so there are no spikes to propagate around the ring.</p>
<h1><a class="anchor" id="initialConditions"></a>
Providing initial stimuli</h1>
<p>We can use a <a class="el" href="../../d5/d1f/classNeuronModels_1_1SpikeSource.html" title="Empty neuron which allows setting spikes from external sources. ">NeuronModels::SpikeSource</a> to inject an initial spike into the first neuron in the ring during the first timestep to start spikes propagating. Firstly we need to define another sparse connectivity initialisation snippet at the top of <code>tenHHRingModel.cc</code> which simply creates a single synapse on the first row of the synaptic matrix: </p><div class="fragment"><div class="line"><span class="keyword">class </span>FirstToFirst : <span class="keyword">public</span> <a class="code" href="../../d5/d9f/classInitSparseConnectivitySnippet_1_1Base.html">InitSparseConnectivitySnippet::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../de/d6c/snippet_8h.html#ac5727a6720d28f034afadde948ed6e9a">DECLARE_SNIPPET</a>(FirstToFirst, 0);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a3758f6bc5bc997383426d5f277b8acc9">SET_ROW_BUILD_CODE</a>(</div><div class="line">        <span class="stringliteral">&quot;if($(id_pre) == 0) {\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;   $(addSynapse, $(id_pre));\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;}\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;$(endRow);\n&quot;</span>);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a338915170111c85ba647e848d28ee2a9">SET_MAX_ROW_LENGTH</a>(1);</div><div class="line">};</div><div class="line"><a class="code" href="../../de/d6c/snippet_8h.html#af3c47debe5fc34060e716d7db25462ab">IMPLEMENT_SNIPPET</a>(FirstToFirst);</div></div><!-- fragment --><p>We then need to add it to the network by adding the following to the end of the <code>modelDefinition(...)</code> function:</p>
<div class="fragment"><div class="line">model.<a class="code" href="../../da/dfd/classModelSpec.html#ad990a7f4af4616daf1ba633133616269">addNeuronPopulation</a>&lt;<a class="code" href="../../d5/d1f/classNeuronModels_1_1SpikeSource.html">NeuronModels::SpikeSource</a>&gt;(<span class="stringliteral">&quot;Stim&quot;</span>, 1, {}, {});</div><div class="line">model.<a class="code" href="../../da/dfd/classModelSpec.html#abd4e9128a5d4f5f993907134218af0c2">addSynapsePopulation</a>&lt;<a class="code" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html">WeightUpdateModels::StaticPulse</a>, <a class="code" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html">PostsynapticModels::ExpCond</a>&gt;(</div><div class="line">    <span class="stringliteral">&quot;StimPop1&quot;</span>, <a class="code" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9ca14329718a99dc337fa3bd33b9104d75d">SynapseMatrixType::SPARSE_GLOBALG</a>, <a class="code" href="../../dc/de1/modelSpec_8h.html#a291aa33d0e485ee09a6881cf8056e13c">NO_DELAY</a>,</div><div class="line">    <span class="stringliteral">&quot;Stim&quot;</span>, <span class="stringliteral">&quot;Pop1&quot;</span>,</div><div class="line">    {}, s_ini,</div><div class="line">    ps_p, {},</div><div class="line">    initConnectivity&lt;FirstToFirst&gt;());</div></div><!-- fragment --><p>and finally inject a spike in the first timestep (in the same way that the <code>t</code> variable is provided by GeNN to keep track of the current simulation time in milliseconds, <code>iT</code> is provided to keep track of it in timesteps):</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(iT == 0) {</div><div class="line">    spikeCount_Stim = 1;</div><div class="line">    spike_Stim[0] = 0;</div><div class="line">    pushStimCurrentSpikesToDevice();</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><code>spike_Stim[n]</code> is used to specify the indices of the neurons in population <code>Stim</code> spikes which should emit spikes where <img class="formulaInl" alt="$n \in [0, \mbox{spikeCount\_Stim} )$" src="../../form_4.png"/>.</dd></dl>
<p>At this point our user code <code>tenHHRingModel.cc</code> should look like this </p><div class="fragment"><div class="line"><span class="comment">// Model definintion file tenHHRing.cc</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dc/de1/modelSpec_8h.html">modelSpec.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>Ring : <span class="keyword">public</span> <a class="code" href="../../d5/d9f/classInitSparseConnectivitySnippet_1_1Base.html">InitSparseConnectivitySnippet::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../de/d6c/snippet_8h.html#ac5727a6720d28f034afadde948ed6e9a">DECLARE_SNIPPET</a>(Ring, 0);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a3758f6bc5bc997383426d5f277b8acc9">SET_ROW_BUILD_CODE</a>(</div><div class="line">        <span class="stringliteral">&quot;$(addSynapse, ($(id_pre) + 1) % $(num_post));\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;$(endRow);\n&quot;</span>);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a338915170111c85ba647e848d28ee2a9">SET_MAX_ROW_LENGTH</a>(1);</div><div class="line">};</div><div class="line"><a class="code" href="../../de/d6c/snippet_8h.html#af3c47debe5fc34060e716d7db25462ab">IMPLEMENT_SNIPPET</a>(Ring);</div><div class="line"></div><div class="line"><span class="keyword">class </span>FirstToFirst : <span class="keyword">public</span> <a class="code" href="../../d5/d9f/classInitSparseConnectivitySnippet_1_1Base.html">InitSparseConnectivitySnippet::Base</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="../../de/d6c/snippet_8h.html#ac5727a6720d28f034afadde948ed6e9a">DECLARE_SNIPPET</a>(FirstToFirst, 0);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a3758f6bc5bc997383426d5f277b8acc9">SET_ROW_BUILD_CODE</a>(</div><div class="line">        <span class="stringliteral">&quot;if($(id_pre) == 0) {\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;   $(addSynapse, $(id_pre));\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;}\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;$(endRow);\n&quot;</span>);</div><div class="line">    <a class="code" href="../../de/d51/initSparseConnectivitySnippet_8h.html#a338915170111c85ba647e848d28ee2a9">SET_MAX_ROW_LENGTH</a>(1);</div><div class="line">};</div><div class="line"><a class="code" href="../../de/d6c/snippet_8h.html#af3c47debe5fc34060e716d7db25462ab">IMPLEMENT_SNIPPET</a>(FirstToFirst);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> modelDefinition(<a class="code" href="../../da/dfd/classModelSpec.html">ModelSpec</a> &amp;model)</div><div class="line">{</div><div class="line">    <span class="comment">// definition of tenHHRing</span></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#a329236a3b07044b82bfda5b4f741d8e1">setDT</a>(0.1);</div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#ada1aff7a94eeb36dff721f09d5cf94b4">setName</a>(<span class="stringliteral">&quot;tenHHRing&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="../../da/d76/classSnippet_1_1ValueBase.html">NeuronModels::TraubMiles::ParamValues</a> p(</div><div class="line">        7.15,       <span class="comment">// 0 - gNa: Na conductance in muS</span></div><div class="line">        50.0,       <span class="comment">// 1 - ENa: Na equi potential in mV</span></div><div class="line">        1.43,       <span class="comment">// 2 - gK: K conductance in muS</span></div><div class="line">        -95.0,      <span class="comment">// 3 - EK: K equi potential in mV</span></div><div class="line">        0.02672,    <span class="comment">// 4 - gl: leak conductance in muS</span></div><div class="line">        -63.563,    <span class="comment">// 5 - El: leak equi potential in mV</span></div><div class="line">        0.143);     <span class="comment">// 6 - Cmem: membr. capacity density in nF</span></div><div class="line"></div><div class="line">    <a class="code" href="../../d6/d24/classModels_1_1VarInitContainerBase.html">NeuronModels::TraubMiles::VarValues</a> ini(</div><div class="line">        -60.0,         <span class="comment">// 0 - membrane potential V</span></div><div class="line">        0.0529324,     <span class="comment">// 1 - prob. for Na channel activation m</span></div><div class="line">        0.3176767,     <span class="comment">// 2 - prob. for not Na channel blocking h</span></div><div class="line">        0.5961207);    <span class="comment">// 3 - prob. for K channel activation n</span></div><div class="line"></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#ad990a7f4af4616daf1ba633133616269">addNeuronPopulation</a>&lt;<a class="code" href="../../d2/dc3/classNeuronModels_1_1TraubMiles.html">NeuronModels::TraubMiles</a>&gt;(<span class="stringliteral">&quot;Pop1&quot;</span>, 10, p, ini);</div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#ad990a7f4af4616daf1ba633133616269">addNeuronPopulation</a>&lt;<a class="code" href="../../d5/d1f/classNeuronModels_1_1SpikeSource.html">NeuronModels::SpikeSource</a>&gt;(<span class="stringliteral">&quot;Stim&quot;</span>, 1, {}, {});</div><div class="line"></div><div class="line">    WeightUpdateModels::StaticPulse::VarValues s_ini(</div><div class="line">         -0.2); <span class="comment">// 0 - g: the synaptic conductance value</span></div><div class="line"></div><div class="line">    <a class="code" href="../../da/d76/classSnippet_1_1ValueBase.html">PostsynapticModels::ExpCond::ParamValues</a> ps_p(</div><div class="line">        1.0,    <span class="comment">// 0 - tau_S: decay time constant for S [ms]</span></div><div class="line">        -80.0); <span class="comment">// 1 - Erev: Reversal potential</span></div><div class="line"></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#abd4e9128a5d4f5f993907134218af0c2">addSynapsePopulation</a>&lt;<a class="code" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html">WeightUpdateModels::StaticPulse</a>, <a class="code" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html">PostsynapticModels::ExpCond</a>&gt;(</div><div class="line">        <span class="stringliteral">&quot;Pop1self&quot;</span>, <a class="code" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9ca14329718a99dc337fa3bd33b9104d75d">SynapseMatrixType::SPARSE_GLOBALG</a>, 100,</div><div class="line">        <span class="stringliteral">&quot;Pop1&quot;</span>, <span class="stringliteral">&quot;Pop1&quot;</span>,</div><div class="line">        {}, s_ini,</div><div class="line">        ps_p, {},</div><div class="line">        initConnectivity&lt;Ring&gt;());</div><div class="line"></div><div class="line">    model.<a class="code" href="../../da/dfd/classModelSpec.html#abd4e9128a5d4f5f993907134218af0c2">addSynapsePopulation</a>&lt;<a class="code" href="../../d9/d74/classWeightUpdateModels_1_1StaticPulse.html">WeightUpdateModels::StaticPulse</a>, <a class="code" href="../../d5/d27/classPostsynapticModels_1_1ExpCond.html">PostsynapticModels::ExpCond</a>&gt;(</div><div class="line">        <span class="stringliteral">&quot;StimPop1&quot;</span>, <a class="code" href="../../dd/dd5/synapseMatrixType_8h.html#a24a045033b9a7e987843a67ff5ddec9ca14329718a99dc337fa3bd33b9104d75d">SynapseMatrixType::SPARSE_GLOBALG</a>, <a class="code" href="../../dc/de1/modelSpec_8h.html#a291aa33d0e485ee09a6881cf8056e13c">NO_DELAY</a>,</div><div class="line">        <span class="stringliteral">&quot;Stim&quot;</span>, <span class="stringliteral">&quot;Pop1&quot;</span>,</div><div class="line">        {}, s_ini,</div><div class="line">        ps_p, {},</div><div class="line">        initConnectivity&lt;FirstToFirst&gt;());</div><div class="line">}</div></div><!-- fragment --><p>and <code>tenHHRingSimulation.cc</code>` should look like this:</p>
<div class="fragment"><div class="line"><span class="comment">// Standard C++ includes</span></div><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// tenHHRing simulation code</span></div><div class="line"><span class="preprocessor">#include &quot;tenHHRing_CODE/definitions.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    allocateMem();</div><div class="line">    initialize();</div><div class="line">    initializeSparse();</div><div class="line"></div><div class="line">    std::ofstream os(<span class="stringliteral">&quot;tenHHRing_output.V.dat&quot;</span>);</div><div class="line">    <span class="keywordflow">while</span>(t &lt; 200.0f) {</div><div class="line">        <span class="keywordflow">if</span>(iT == 0) {</div><div class="line">            glbSpkStim[0] = 0;</div><div class="line">            glbSpkCntStim[0] = 1;</div><div class="line">            pushStimCurrentSpikesToDevice();</div><div class="line">        }</div><div class="line"></div><div class="line">        stepTimeU();</div><div class="line">        pullVPop1FromDevice();</div><div class="line"></div><div class="line">        os &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j= 0; j &lt; 10; j++) {</div><div class="line">            os &lt;&lt; VPop1[j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line">        }</div><div class="line">        os &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">    os.close();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p> Finally if we build, make and run this model; and plot the first 200 ms of the ten neurons' membrane voltages - they now looks like this: </p><div class="image">
<img src="../../tenHHRingexample2.png" alt="tenHHRingexample2.png"/>
</div>
 <hr/>
<p> <a class="el" href="../../d5/dbb/Tutorial1.html">Previous</a> | <a class="el" href="../../dc/d7e/Tutorial2.html">Top</a> | <a class="el" href="../../d0/da6/UserGuide.html">Next</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 3 2020 18:55:17 for GeNN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
