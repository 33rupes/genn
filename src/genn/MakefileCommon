# Determine whether OS is Darwin i.e. Mac OS X and whether the kernel is 32 or 64 bit
OS_SIZE			:=$(shell getconf LONG_BIT)
OS_UPPER		:=$(shell uname -s 2>/dev/null | tr [:lower:] [:upper:])
DARWIN			:=$(strip $(findstring DARWIN,$(OS_UPPER)))

# Get directory of this makefile i.e. GeNN directory (means make can be invoked else where)
GENN_DIR 		:= $(abspath $(dir $(lastword $(MAKEFILE_LIST)))../../)

# Set standard compiler and archiver flags
CXXFLAGS 		+=-std=c++11 -Wall -Wpedantic -Wextra -MMD -MP -I$(GENN_DIR)/include/genn -I$(GENN_DIR)/include/genn/third_party
ARFLAGS			:=-rcs

# On Mac OS X, use Clang++ rather than GC++
ifeq ($(DARWIN),DARWIN)
	CXX		:=clang++
endif

# Setup compiler based on configuration
ifdef MPI_ENABLE
	GENN_PREFIX	:=$(GENN_PREFIX)_mpi
	CXXFLAGS	+=-DMPI_ENABLE
	CXX		:=mpiCC
endif

ifdef COVERAGE
	GENN_PREFIX	:=$(GENN_PREFIX)_coverage
	CXXFLAGS	+=-O0 --coverage
endif

ifdef DEBUG
	GENN_PREFIX	:=$(GENN_PREFIX)_debug
	CXXFLAGS	+=-g -O0 -DDEBUG
endif 

# Add prefix to object directory and library name
OBJECT_DIRECTORY	:=$(GENN_DIR)/obj$(GENN_PREFIX)
LIBGENN			:=$(GENN_DIR)/lib/libgenn$(GENN_PREFIX).a