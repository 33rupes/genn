<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>GeNN: Best practices guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--This is Google Analytics Tracking Code-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-57354659-1', 'auto');
  ga('send', 'pageview');
</script>
<!--End of Google Analytics Tracking Code-->
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="html_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em; padding-bottom: 0.5em;" id="projectlogo"><img alt="Logo" src="GeNN-logo-55px.gif"/></td>
  <td style="padding-left: 3.5em; padding-bottom: 0.5em;">
   <div id="projectname">GeNN
   &#160;<span id="projectnumber">3.1.0</span>
   </div>
   <div id="projectbrief">GPU enhanced Neuronal Networks (GeNN)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('UserGuide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Best practices guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>GeNN generates code according to the network model defined by the user, and allows users to include the generated code in their programs as they want. Here we provide a guideline to setup GeNN and use generated functions. We recommend users to also have a look at the <a class="el" href="Examples.html">Examples</a>, and to follow the tutorials <a class="el" href="Tutorial1.html">Tutorial 1</a> and <a class="el" href="Tutorial2.html">Tutorial 2</a>.</p>
<h1><a class="anchor" id="CreateAndSimulate"></a>
Creating and simulating a network model</h1>
<p>The user is first expected to create an object of class <a class="el" href="dc/de5/classNNmodel.html">NNmodel</a> by creating the function modelDefinition() which includes calls to following methods in correct order:</p>
<ul>
<li><a class="el" href="dc/de1/modelSpec_8h.html#a62ce532f6f7e535adfb9fe151a1c0c6b" title="Method for GeNN initialisation (by preparing standard models) ">initGeNN()</a>;</li>
<li><a class="el" href="dc/de5/classNNmodel.html#aa8283ad87bc9d6caa854d21ca4f9b249" title="Set the integration step size of the model. ">NNmodel::setDT()</a>;</li>
<li><a class="el" href="dc/de5/classNNmodel.html#aba858ed73e029de0366ab23f973b1273" title="Method to set the neuronal network model name. ">NNmodel::setName()</a>;</li>
</ul>
<p>Then add neuron populations by:</p>
<ul>
<li><a class="el" href="dc/de5/classNNmodel.html#a8d7d593837882775dfb89a9780c06fab" title="Method for adding a neuron population to a neuronal network model, using C++ string for the name of t...">NNmodel::addNeuronPopulation()</a>;</li>
</ul>
<p>for each neuron population. Add synapse populations by:</p>
<ul>
<li><a class="el" href="dc/de5/classNNmodel.html#aae817535d08ab6b35ef1e2348b03a37c" title="This function has been depreciated as of GeNN 2.2. ">NNmodel::addSynapsePopulation()</a>;</li>
</ul>
<p>for each synapse population.</p>
<p>The modelDefinition() needs to end with calling <a class="el" href="dc/de5/classNNmodel.html#aaee7f16c9627dddb2588bad24afe5d15" title="Declare that the model specification is finalised in modelDefinition(). ">NNmodel::finalize()</a>.</p>
<p>Other optional functions are explained in <a class="el" href="dc/de5/classNNmodel.html">NNmodel</a> class reference. At the end the function should look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> modelDefinition(NNModel &amp;model) {</div><div class="line">  <a class="code" href="dc/de1/modelSpec_8h.html#a62ce532f6f7e535adfb9fe151a1c0c6b">initGeNN</a>();</div><div class="line">  model.setDT(0.5);</div><div class="line">  model.setName(<span class="stringliteral">&quot;YourModelName&quot;</span>);</div><div class="line">  model.addNeuronPopulation(...);</div><div class="line">  ...</div><div class="line">  model.addSynapsePopulation(...);</div><div class="line">  ...</div><div class="line">  model.finalize();</div><div class="line">}</div></div><!-- fragment --><p><a class="el" href="dc/de1/modelSpec_8h.html" title="Header file that contains the class (struct) definition of neuronModel for defining a neuron model an...">modelSpec.h</a> should be included in the file where this function is defined.</p>
<p>This function will be called by <a class="el" href="df/d10/generateALL_8cc.html" title="Main file combining the code for code generation. Part of the code generation section. ">generateALL.cc</a> to create corresponding CPU and GPU simulation codes under the &lt;YourModelName&gt;_CODE directory.</p>
<p>These functions can then be used in a .cc file which runs the simulation. This file should include &lt;YourModelName&gt;_CODE/definitions.h. Generated code differ from one model to the other, but core functions are the same and they should be called in correct order. First, the following variables should be defined and initialized:</p>
<ul>
<li><a class="el" href="dc/de5/classNNmodel.html">NNmodel</a> model // initialized by calling modelDefinition(model)</li>
<li>Array containing current input (if any)</li>
</ul>
<p>The following are declared by GeNN but should be initialized by the user:</p><ul>
<li>Poisson neuron offset and rates (if any)</li>
<li>Connectivity matrices (if sparse)</li>
<li>Neuron and synapse variables (if not initialising to the homogeneous initial value provided during <code>modelDefinition</code>)</li>
</ul>
<p>Core functions generated by GeNN to be included in the user code include:</p>
<ul>
<li><code>allocateMem()</code></li>
<li><code>deviceMemAllocate()</code></li>
<li><code>initialize()</code></li>
<li><code>init&lt;model name&gt;()</code></li>
<li><code>push&lt;neuron or synapse name&gt;StateToDevice()</code></li>
<li><code>pull&lt;neuron or synapse name&gt;StateFromDevice()</code></li>
<li><code>push&lt;neuron name&gt;SpikesToDevice()</code></li>
<li><code>pull&lt;neuron name&gt;SpikesFromDevice()</code></li>
<li><code>push&lt;neuron name&gt;SpikesEventsToDevice()</code></li>
<li><code>pull&lt;neuron name&gt;SpikesEventsFromDevice()</code></li>
<li><code>push&lt;neuron name&gt;CurrentSpikesToDevice()</code></li>
<li><code>pull&lt;neuron name&gt;CurrentSpikesFromDevice()</code></li>
<li><code>push&lt;neuron name&gt;CurrentSpikesEventsToDevice()</code></li>
<li><code>pull&lt;neuron name&gt;CurrentSpikesEventsFromDevice()</code></li>
<li><code>copyStateToDevice()</code></li>
<li><code>copyStateFromDevice()</code></li>
<li><code>copySpikesToDevice()</code></li>
<li><code>copySpikesFromDevice()</code></li>
<li><code>copySpikesEventsToDevice()</code></li>
<li><code>copySpikesEventsFromDevice()</code></li>
<li><code>copyCurrentSpikesToDevice()</code></li>
<li><code>copyCurrentSpikesFromDevice()</code></li>
<li><code>copyCurrentSpikesEventsToDevice()</code></li>
<li><code>copyCurrentSpikesEventsFromDevice()</code></li>
<li><code>stepTimeCPU()</code></li>
<li><code>stepTimeGPU()</code></li>
<li><code>freeMem()</code></li>
</ul>
<p>Before calling the kernels, <b>make sure you have copied the initial values of any neuron and synapse variables initialised on the host to the GPU</b>. You can use the <code>push\&lt;neuron or synapse name\&gt;StateToDevice()</code> to copy from the host to the GPU. At the end of your simulation, if you want to access the variables you need to copy them back from the device using the <code>pull\&lt;neuron or synapse name\&gt;StateFromDevice()</code> function or one of the more fine-grained functions listed above. Alternatively, you can directly use the CUDA memcopy functions. <b>Copying elements between the GPU and the host memory is very costly in terms of performance and should only be done when needed.</b></p>
<h1><a class="anchor" id="floatPrecision"></a>
Floating point precision</h1>
<p>Double precision floating point numbers are supported by devices with compute capability 1.3 or higher. If you have an older GPU, you need to use single precision floating point in your models and simulation.</p>
<p>GPUs are designed to work better with single precision while double precision is the standard for CPUs. This difference should be kept in mind while comparing performance.</p>
<p>While setting up the network for GeNN, double precision floating point numbers are used as this part is done on the CPU. For the simulation, GeNN lets users choose between single or double precision. Overall, new variables in the generated code are defined with the precision specified by NNmodel::setPrecision(unsigned int), providing GENN_FLOAT or GENN_DOUBLE as argument. GENN_FLOAT is the default value. The keyword <code>scalar</code> can be used in the user-defined model codes for a variable that could either be single or double precision. This keyword is detected at code generation and substituted with "float" or "double" according to the precision set by NNmodel::setPrecision(unsigned int).</p>
<p>There may be ambiguities in arithmetic operations using explicit numbers. Standard C compilers presume that any number defined as "X" is an integer and any number defined as "X.Y" is a double. Make sure to use the same precision in your operations in order to avoid performance loss.</p>
<h1><a class="anchor" id="ListOfVariables"></a>
Working with variables in GeNN</h1>
<h2><a class="anchor" id="modelVars"></a>
Model variables</h2>
<p>User-defined model variables originate from classes derived off the <a class="el" href="d7/dad/classNeuronModels_1_1Base.html" title="Base class for all neuron models. ">NeuronModels::Base</a>, <a class="el" href="d2/d05/classWeightUpdateModels_1_1Base.html" title="Base class for all weight update models. ">WeightUpdateModels::Base</a> or <a class="el" href="d1/d3a/classPostsynapticModels_1_1Base.html" title="Base class for all postsynaptic models. ">PostsynapticModels::Base</a> classes. The name of model variable is defined in the model type, i.e. with a statement such as </p><div class="fragment"><div class="line"><a class="code" href="d4/ded/newModels_8h.html#a3025b9fc844fccdf8cc2b51ef4a6e0aa">SET_VARS</a>({{<span class="stringliteral">&quot;V&quot;</span>, <span class="stringliteral">&quot;scalar&quot;</span>}});</div></div><!-- fragment --><p> When a neuron or synapse population using this model is added to the model, the full GeNN name of the variable will be obtained by concatenating the variable name with the name of the population. For example if we a add a population called <code>Pop</code> using a model which contains our <code>V</code> variable, a variable <code>VPop</code> of type <code>scalar*</code> will be available in the global namespace of the simulation program. GeNN will pre-allocate this C array to the correct size of elements corresponding to the size of the neuron population. GeNN will also free these variables when the provided function <code>freeMem()</code> is called. Users can otherwise manipulate these variable arrays as they wish. For convenience, GeNN provides functions <code>pullXXStatefromDevice()</code> and <code>pushXXStatetoDevice()</code> to copy the variables associated to a neuron population <code>XX</code> from the device into host memory and vice versa. E.g. </p><div class="fragment"><div class="line">pullPopStateFromDevice();</div></div><!-- fragment --><p> would copy the C array VPop from device memory into host memory (and any other variables that the population <code>Pop</code> may have).</p>
<p>The user can also directly use CUDA memory copy commands independent of the provided convenience functions. The relevant device pointers for all variables that exist in host memory have the same name as the host variable but are prefixed with <code>d_</code>. For example, the copy command that would be contained in <code>pullPopStateFromDevice()</code> will look like </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = <span class="keyword">sizeof</span>(scalar) * nPop;      </div><div class="line">cudaMemcpy(VPop, d_VPop, size, cudaMemcpyDeviceToHost);</div></div><!-- fragment --><p> where <code>nPop</code> is an integer containing the population size of the <code>Pop</code> population.</p>
<p>Thes conventions also apply to the the variables of postsynaptic and weight update models. </p><dl class="section note"><dt>Note</dt><dd>Be aware that the above naming conventions do assume that variables from the weightupdate models and the postSynModels that are used together in a synapse population are unique. If both the weightupdate model and the <a class="el" href="d2/d1a/classpostSynModel.html" title="Class to hold the information that defines a post-synaptic model (a model of how synapses affect post...">postSynModel</a> have a variable of the same name, the behaviour is undefined.</dd></dl>
<h2><a class="anchor" id="predefinedVars"></a>
Built-in Variables in GeNN</h2>
<p>GeNN has no explicitly hard-coded synapse and neuron variables. Users are free to name the variable of their models as they want. However, there are some reserved variables that are used for intermediary calculations and communication between different parts of the generated code. They can be used in the user defined code but no other variables should be defined with these names.</p>
<ul>
<li><code>DT</code> : Time step (typically in ms) for simulation; Neuron integration can be done in multiple sub-steps inside the neuron model for numerical stability (see Traub-Miles and Izhikevich neuron model variations in <a class="el" href="sectNeuronModels.html">Neuron models</a>).</li>
<li><code>addtoinSyn</code> : This variable is used by <a class="el" href="d2/d05/classWeightUpdateModels_1_1Base.html" title="Base class for all weight update models. ">WeightUpdateModels::Base</a> for updating synaptic input. The way it is modified is defined using the SET_SIM_CODE or SET_EVENT_CODE macros, therefore if a user defines her own model she should update this variable to contain the input to the post-synaptic model.</li>
<li><code>updatelinsyn</code> : At the end of the synaptic update by <code>addtoinSyn</code>, final values are copied back to the d_inSyn&lt;synapsePopulation&gt; variables which will be used in the next step of the neuron update to provide the input to the postsynaptic neurons. This keyword designated where the changes to <code>addtoinSyn</code> have been completed and it is safe to update the summed synaptic input and write back to d_inSyn&lt;synapsePopulation&gt; in device memory.</li>
<li><code>inSyn:</code> This is an intermediary synapse variable which contains the summed input into a postsynaptic neuron (originating from the <code>addtoinSyn</code> variables of the incoming synapses) .</li>
<li><code>Isyn</code> : This is a local variable which contains the (summed) input current to a neuron. It is typically the sum of any explicit current input and all synaptic inputs. The way its value is calculated during the update of the postsynaptic neuron is defined by the code provided in the postsynaptic model. For example, the standard <a class="el" href="d5/d27/classPostsynapticModels_1_1ExpCond.html" title="Exponential decay with synaptic input treated as a conductance value. ">PostsynapticModels::ExpCond</a> postsynaptic model defines <div class="fragment"><div class="line"><a class="code" href="da/d05/newPostsynapticModels_8h.html#a41d7141aeae91e2840c2629106b6a3b1">SET_APPLY_INPUT_CODE</a>(<span class="stringliteral">&quot;$(Isyn) += $(inSyn)*($(E)-$(V))&quot;</span>);</div></div><!-- fragment --> which implements a conductance based synapse in which the postsynaptic current is given by <img class="formulaInl" alt="$I_{\rm syn}= g*s*(V_{\rm rev}-V_{\rm post})$" src="form_23.png"/>. <dl class="section note"><dt>Note</dt><dd>The <code>addtoinSyn</code> variables from all incoming synapses are automatically summed and added to the current value of <code>inSyn</code>.</dd></dl>
The value resulting from the current converter code is assigned to <code>Isyn</code> and can then be used in neuron sim code like so: <div class="fragment"><div class="line">$(V)+= (-$(V)+$(Isyn))*DT </div></div><!-- fragment --></li>
<li><code>sT</code> : This is a neuron variable containing the last spike time of each neuron and is automatically generated for pre and postsynaptic neuron groups if they are connected using a synapse population with a weight update model that has <a class="el" href="d4/d0f/newWeightUpdateModels_8h.html#ad06378df00a5d9ffe4068ba2c01b09ab">SET_NEEDS_PRE_SPIKE_TIME(true)</a> or <a class="el" href="d4/d0f/newWeightUpdateModels_8h.html#a4f3e008922887cba8cfafc0fb0e53965">SET_NEEDS_POST_SPIKE_TIME(true)</a> set.</li>
</ul>
<p>In addition to these variables, neuron variables can be referred to in the synapse models by calling $(&lt;neuronVarName&gt;_pre) for the presynaptic neuron population, and $(&lt;neuronVarName&gt;_post) for the postsynaptic population. For example, $(sT_pre), $(sT_post), $(V_pre), etc.</p>
<h1><a class="anchor" id="Debugging"></a>
Debugging suggestions</h1>
<p>In Linux, users can call <code>cuda-gdb</code> to debug on the GPU. Example projects in the <code>userproject</code> directory come with a flag to enable debugging (DEBUG=1). genn-buildmodel.sh has a debug flag (-d) to generate debugging data. If you are executing a project with debugging on, the code will be compiled with -g -G flags. In CPU mode the executable will be run in gdb, and in GPU mode it will be run in cuda-gdb in tui mode.</p>
<dl class="section note"><dt>Note</dt><dd>Do not forget to switch debugging flags -g and -G off after debugging is complete as they may negatively affect performance.</dd></dl>
<p>On Mac, some versions of <code>clang</code> aren't supported by the CUDA toolkit. This is a recurring problem on Fedora as well, where CUDA doesn't keep up with GCC releases. You can either hack the CUDA header which checks compiler versions - <code>cuda/include/host_config.h</code> - or just use an older XCode version (6.4 works fine).</p>
<p>On Windows models can also be debugged and developed by opening the vcxproj file used to build the model in Visual Studio. From here files can be added to the project, build settings can be adjusted and the full suite of Visual Studio debugging and profiling tools can be used. </p><dl class="section note"><dt>Note</dt><dd>When opening the models in the <code>userproject</code> directory in Visual Studio, right-click on the project in the solution explorer, select 'Properties'. Then, making sure the desired configuration is selected, navigate to 'Debugging' under 'Configuration Properties', set the 'Working Directory' to '..' and the 'Command Arguments' to match those passed to genn-buildmodel e.g. 'outdir 1' to use an output directory called outdir and to run the model on the GPU. <hr/>
 <a class="el" href="Tutorial2.html">Previous</a> | <a class="el" href="UserGuide.html">Top</a> | <a class="el" href="Credits.html">Next</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 14 2018 11:31:59 for GeNN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
